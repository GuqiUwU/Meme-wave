<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MemeWave - made by Giu Giu</title>
  <link rel="icon" href="https://tse4.mm.bing.net/th/id/OIP.piRzWtMCSbpX-WL21vFMSgAAAA?rs=1&pid=ImgDetMain&o=7&rm=3" type="image/jpeg">
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Simple, smooth animations for all interactions */
    @keyframes slideIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes pulseGlow {
      0%, 100% { box-shadow: 0 0 5px rgba(99, 102, 241, 0.5); }
      50% { box-shadow: 0 0 20px rgba(99, 102, 241, 0.8); }
    }
    @keyframes subtleRipple {
      0% { transform: scale(1); }
      50% { transform: scale(1.02); }
      100% { transform: scale(1); }
    }
    @keyframes tabSlide {
      from { transform: translateX(0); }
      to { transform: translateX(100%); }
    }
    @keyframes tabSlideBack {
      from { transform: translateX(100%); }
      to { transform: translateX(0); }
    }
    .ripple-effect {
      position: relative;
      overflow: hidden;
      transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }
    .ripple-effect:hover {
      transform: translateY(-1px);
    }
    .ripple-effect::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: radial-gradient(circle, rgba(99, 102, 241, 0.3) 0%, transparent 70%);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      animation: ripple 0.6s ease-out;
      transition: all 0.2s ease;
    }
    @keyframes ripple {
      0% {
        transform: scale(0);
        opacity: 1;
      }
      100% {
        transform: scale(4);
        opacity: 0;
      }
    }
    .tab-container {
      position: relative;
      display: flex;
      gap: 0;
      overflow: hidden;
      border-radius: 9999px;
      background: rgba(55, 65, 81, 0.6);
      padding: 4px;
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
    }
    .tab-button {
      position: relative;
      z-index: 2;
      background: transparent;
      border: none;
      padding: 8px 20px;
      border-radius: 9999px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      font-weight: 500;
      flex: 1; /* Equal width for both buttons */
      text-align: center;
    }
    .tab-button:hover {
      background: rgba(99, 102, 241, 0.2);
      transform: translateY(-1px);
      animation: subtleRipple 0.6s ease-in-out;
    }
    .tab-button.active {
      color: white;
      background: rgba(99, 102, 241, 0.4);
      box-shadow: 0 2px 8px rgba(99, 102, 241, 0.3);
    }
    .tab-button:not(.active) {
      color: rgba(156, 163, 175, 0.8);
    }
    /* Smooth tab indicator slide */
    .tab-indicator {
      position: absolute;
      bottom: 4px;
      left: 4px;
      height: calc(100% - 8px);
      background: linear-gradient(135deg, #3b82f6, #22c55e);
      border-radius: 9999px;
      transition: left 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      z-index: 1;
      width: calc(50% - 2px);
    }
    .card-enter {
      animation: fadeInUp 0.5s ease-out forwards;
    }
    .loading-pulse {
      animation: pulseGlow 2s infinite;
    }
    .modal-fade {
      animation: slideIn 0.3s ease-out;
    }
    /* Smooth grid item stagger */
    .grid-item {
      opacity: 0;
      animation: fadeInUp 0.6s ease-out forwards;
    }
    .grid-item:nth-child(1) { animation-delay: 0.1s; }
    .grid-item:nth-child(2) { animation-delay: 0.15s; }
    .grid-item:nth-child(3) { animation-delay: 0.2s; }
    .grid-item:nth-child(4) { animation-delay: 0.25s; }
    /* Hover scale for all cards */
    .meme-card, .anime-card, .video-card {
      transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }
    .meme-card:hover, .anime-card:hover, .video-card:hover {
      transform: scale(1.02) translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
    }
    /* Button universal hover */
    button {
      transition: all 0.2s ease;
    }
    button:hover {
      transform: translateY(-1px);
    }
    select {
      transition: all 0.2s ease;
    }
    select:hover {
      transform: scale(1.02);
    }
    /* Password modal */
    .password-modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 100;
    }
    .password-input {
      padding: 12px;
      font-size: 18px;
      border: none;
      border-radius: 8px;
      background: #374151;
      color: white;
      text-align: center;
      width: 200px;
    }
    /* Admin background - directly replace dark blue with image */
    .admin-bg {
      background-image: url('https://i.kym-cdn.com/editorials/icons/original/000/005/643/boykisser.jpeg');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      background-attachment: fixed;
    }
    /* Lighten the background with overlay */
    .admin-bg::before {
      content: "";
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.1);
      pointer-events: none;
      z-index: -1;
    }
    .video-player {
      position: relative;
      padding-bottom: 56.25%; /* 16:9 aspect ratio */
      height: 0;
      overflow: hidden;
    }
    .video-player iframe {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border: none;
      border-radius: 8px;
    }
    /* Progress bar for video loading */
    .progress-bar {
      width: 100%;
      height: 4px;
      background-color: rgba(156, 163, 175, 0.3);
      border-radius: 2px;
      overflow: hidden;
    }
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #3b82f6, #22c55e);
      width: 0%;
      transition: width 0.3s ease;
      animation: progress-anim 2s infinite ease-in-out;
    }
    @keyframes progress-anim {
      0% { width: 0%; }
      50% { width: 70%; }
      100% { width: 100%; }
    }
  </style>
</head>
<body class="bg-gray-900 text-gray-100 font-sans min-h-screen">
  <div id="root"></div>
  <script type="text/babel">
    const { useEffect, useState, useRef, useMemo, useCallback } = React;
    function MemeWaveApp() {
      const [route, setRoute] = useState("feed");
      const [lang, setLang] = useState("zh");
      const [foreignFeed, setForeignFeed] = useState([]);
      const [domesticFeed, setDomesticFeed] = useState([]);
      const [videos, setVideos] = useState([]);
      const [videosLoading, setVideosLoading] = useState(false);
      const [loading, setLoading] = useState(false);
      const [activeTab, setActiveTab] = useState("foreign");
      const [timeFilter, setTimeFilter] = useState("all");
      const [error, setError] = useState(null);
      const [selectedMeme, setSelectedMeme] = useState(null);
      const [showBoyKisser, setShowBoyKisser] = useState(false);
      const [showAdminPassword, setShowAdminPassword] = useState(false);
      const [passwordInput, setPasswordInput] = useState("");
      const [hasMoreForeign, setHasMoreForeign] = useState(false);
      const [hasMoreDomestic, setHasMoreDomestic] = useState(false);
      const [isLoadingMore, setIsLoadingMore] = useState(false);
      const [backgroundInterval, setBackgroundInterval] = useState(null);
      useEffect(() => {
        loadFeeds();
      }, []);
      useEffect(() => {
        if (backgroundInterval) clearInterval(backgroundInterval);
        const interval = setInterval(() => {
          const inactiveTab = activeTab === "foreign" ? "domestic" : "foreign";
          const inactiveFeed = inactiveTab === "foreign" ? foreignFeed : domesticFeed;
          const inactiveHasMore = inactiveTab === "foreign" ? hasMoreForeign : hasMoreDomestic;
          if (inactiveFeed.length < 200 && inactiveHasMore && !isLoadingMore) {
            loadMoreFeed(inactiveTab);
          }
        }, 10000);
        setBackgroundInterval(interval);
        return () => clearInterval(interval);
      }, [activeTab, foreignFeed.length, domesticFeed.length, hasMoreForeign, hasMoreDomestic, isLoadingMore, loadMoreFeed]);
      // useEffect for admin background - directly applied to body
      useEffect(() => {
        if (route === "admin") {
          document.body.classList.add('admin-bg');
        } else {
          document.body.classList.remove('admin-bg');
        }
        return () => {
          document.body.classList.remove('admin-bg');
        };
      }, [route]);
      const handleTabClick = useCallback((tab) => {
        if (activeTab === tab) return;
        setActiveTab(tab);
      }, [activeTab]);
      const handleAdminClick = () => {
        setShowAdminPassword(true);
      };
      const handlePasswordSubmit = (e) => {
        e.preventDefault();
        if (passwordInput === "FURRYXD") {
          loadVideos();
          setRoute("admin");
          setShowAdminPassword(false);
          setPasswordInput("");
        } else {
          alert("Wrong password!");
          setPasswordInput("");
        }
      };
      // Function to load videos including YouTube
      async function loadVideos() {
        setVideosLoading(true);
        try {
          const vidData = await tryFetchVideos();
          setVideos(shuffleArray(vidData).slice(0, 20));
        } catch (e) {
          console.error(e);
          setError(lang === 'en' ? "Failed to load videos." : "åŠ è½½è§†é¢‘å¤±è´¥ã€‚");
        } finally {
          setVideosLoading(false);
        }
      }
      async function loadFeeds() {
        setLoading(true);
        setError(null);
        try {
          const fImgs = await tryFetchForeignImages();
          const dImgs = await tryFetchDomesticImages();
          setForeignFeed(shuffleArray(fImgs).slice(0, 40));
          setHasMoreForeign(fImgs.length >= 40);
          setDomesticFeed(shuffleArray(dImgs).slice(0, 40));
          setHasMoreDomestic(dImgs.length >= 40);
        } catch (e) {
          console.error(e);
          setError(lang === 'en' ? "Failed to load some memes. Check console. Might be CORS or API Key required." : "åŠ è½½éƒ¨åˆ†æ¢—å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ§åˆ¶å°ã€‚å¯èƒ½æ˜¯ CORS æˆ–æ¥å£éœ€è¦ API Keyã€‚");
        } finally {
          setLoading(false);
        }
      }
      const loadMoreFeed = useCallback(async (tab) => {
        if (isLoadingMore) return;
        const hasMore = tab === "foreign" ? hasMoreForeign : hasMoreDomestic;
        if (!hasMore) return;
        setIsLoadingMore(true);
        try {
          let moreImgs;
          if (tab === "foreign") {
            moreImgs = await tryFetchForeignImages();
          } else {
            moreImgs = await tryFetchDomesticImages();
          }
          const currentFeedState = tab === "foreign" ? foreignFeed : domesticFeed;
          const newMemes = moreImgs.filter(m => !currentFeedState.some(c => c.id === m.id));
          const toAdd = shuffleArray(newMemes).slice(0, 20);
          const updatedFeed = [...currentFeedState, ...toAdd];
          if (tab === "foreign") {
            setForeignFeed(updatedFeed);
            setHasMoreForeign(toAdd.length > 0 || moreImgs.length >= 20);
          } else {
            setDomesticFeed(updatedFeed);
            setHasMoreDomestic(toAdd.length > 0 || moreImgs.length >= 20);
          }
        } catch (e) {
          console.error(e);
        } finally {
          setIsLoadingMore(false);
        }
      }, [foreignFeed, domesticFeed, hasMoreForeign, hasMoreDomestic, isLoadingMore]);
      const currentFeed = activeTab === "foreign" ? foreignFeed : domesticFeed;
      const filteredFeed = useMemo(() => {
        const now = new Date();
        return currentFeed.filter((m) => {
          if (timeFilter === "all" || !m.date) return true;
          const mDate = new Date(m.date);
          switch (timeFilter) {
            case "today":
              return mDate.toDateString() === now.toDateString();
            case "week":
              return mDate > new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
            case "month":
              return mDate > new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
            default:
              return true;
          }
        });
      }, [currentFeed, timeFilter]);
      const hasMore = activeTab === "foreign" ? hasMoreForeign : hasMoreDomestic;
      const t = (key) => {
        const translations = {
          zh: {
            title: "MemeWave",
            hotMemes: "çƒ­æ¢—å¢™",
            animeWatching: "ä½œè€…åœ¨çœ‹çš„ç•ª",
            credits: "åˆ¶ä½œåå•",
            admin: "Admin",
            boyKisser: "Boy Kisser",
            refresh: "åˆ·æ–°æ¢—",
            overseas: "æµ·å¤–",
            domestic: "å›½å†…",
            unstable: "(ä¸ç¨³å®š)",
            timeFilter: "æ—¶é—´ç­›é€‰ï¼š",
            all: "å…¨éƒ¨",
            today: "ä»Šå¤©",
            week: "ä¸€å‘¨å†…",
            month: "ä¸€æœˆå†…",
            loading: "æŠ“æ¢—ä¸­... ğŸœ",
            noResults: "æ— åŒ¹é…ç»“æœï¼Œå°è¯•è°ƒæ•´ç­›é€‰æˆ–åˆ·æ–°ã€‚",
            end: "~ åˆ°åº•äº† ~",
            loadingMore: "åŠ è½½æ›´å¤š...",
            multiSource: "å¤šæ¥æºåˆå¹¶ Â· çº¯å‰ç«¯",
            back: "è¿”å›",
            animeTitle: "ä½œè€…åœ¨çœ‹çš„ç•ª",
            videosTitle: "å†…ç½®è§†é¢‘å¢™ (Bilibili Top + Douyin + YouTube)",
            footer: "å‰ç«¯æ¼”ç¤º â€” å·²æ¥å…¥å¤šä¸ªæ¥æºï¼ˆè§ä»£ç æ³¨é‡Šï¼‰ã€‚è‹¥æ— æ³•æ˜¾ç¤ºå›¾ç‰‡ï¼Œé€šå¸¸æ˜¯ CORS æˆ–éœ€ API Keyã€‚å¯åœ¨æœ¬åœ°ç”¨ dev proxy è§£å†³ã€‚æ–°å¢æ—¶é—´ç­›é€‰ï¼ˆåŸºäºå¯ç”¨æ—¥æœŸå­—æ®µï¼‰åŠå›¾ç‰‡ç‚¹å‡»æŸ¥çœ‹å¤§å›¾ã€‚æ–°å¢æ— é™æ»šåŠ¨åŠ è½½åŠåå°ç¼“å­˜é¢„åŠ è½½ã€‚å›½å†…æ¥æºï¼šmemes.tw (é™æ€æŠ“å–æœ‰é™) + Bilibili åŠ¨æ€å›¾ç‰‡ï¼ˆä¼˜åŒ–æ ‡é¢˜æå–ï¼‰ã€‚å…¨äº¤äº’å¹³æ»‘åŠ¨ç”»ï¼šæ ‡ç­¾æ»‘åŠ¨æŒ‡ç¤ºå™¨ã€æŒ‰é’®å¾®åŠ¨ã€å¡ç‰‡æ¸ç°/æ‚¬åœã€æ¨¡æ€æ·¡å…¥ã€‚æ–°å¢ Admin é¢æ¿ï¼šå¯†ç  FURRYXD è¿›å…¥è§†é¢‘å¢™ï¼ˆBilibili Top & Douyin & YouTube embedsï¼‰ã€‚",
            animeDesc: "å½“å®…ç”·å“¥å“¥ä¸å°å¿ƒç”¨å¯ç–‘è¯ç‰©æŠŠè‡ªå·±çš„å“¥å“¥å˜æˆäº†å¥³å­©å­åï¼Œå±•å¼€çš„çˆ†ç¬‘æ—¥å¸¸æ•…äº‹ã€‚",
            episodes: "Season 1",
            status: "Watching",
            animeListNote: "Giu Giu çš„è¿½ç•ªåˆ—è¡¨ â€” åŸºäº MyAnimeList æ•°æ®ï¼Œçº¯é™æ€å±•ç¤ºã€‚",
            loadingVideos: "åŠ è½½è§†é¢‘ä¸­...",
          },
          en: {
            title: "MemeWave",
            hotMemes: "Hot Memes",
            animeWatching: "Anime I'm Watching",
            credits: "Credits",
            admin: "Admin",
            boyKisser: "Boy Kisser",
            refresh: "Refresh Memes",
            overseas: "Overseas",
            domestic: "Domestic",
            unstable: "(Unstable)",
            timeFilter: "Time Filter:",
            all: "All",
            today: "Today",
            week: "This Week",
            month: "This Month",
            loading: "Fetching memes... ğŸœ",
            noResults: "No matching results. Try adjusting filter or refresh.",
            end: "~ End of feed ~",
            loadingMore: "Loading more...",
            multiSource: "Multi-source Â· Pure Frontend",
            back: "Back",
            animeTitle: "Anime I'm Watching",
            videosTitle: "Built-in Video Wall (Bilibili Top + Douyin + YouTube)",
            footer: "Frontend demo â€” Integrated multiple sources (see code comments). If images fail to load, it's usually CORS or API Key needed. Solve with local dev proxy. Added time filtering (based on available date fields) and image click to view full size. Added infinite scroll and background caching preload. Domestic: memes.tw (limited static scrape) + Bilibili dynamic images (improved title extraction). All interactions with smooth animations: tab sliding indicator, button micro-motions, card fade-in/hover, modal fade-in. Added Admin panel: Password FURRYXD to enter video wall (Bilibili Top & Douyin & YouTube embeds).",
            animeDesc: "After a shut-in brother accidentally turns his brother into a girl with suspicious drugs, an explosive daily life story unfolds.",
            episodes: "Season 1",
            status: "Watching",
            animeListNote: "Giu Giu's anime watchlist â€” Based on MyAnimeList data, static display.",
            loadingVideos: "Loading videos...",
          }
        };
        return translations[lang][key] || key;
      };
      const boyKisserMeme = {
        id: "boykisser",
        title: t('boyKisser'),
        url: "https://tse4.mm.bing.net/th/id/OIP.piRzWtMCSbpX-WL21vFMSgAAAA?rs=1&pid=ImgDetMain&o=7&rm=3",
        source: "Boy Kisser"
      };
      return (
        <div className="min-h-screen bg-gray-900 text-gray-100 font-sans">
          <header className="p-4 flex items-center justify-between border-b border-gray-800 transition-all duration-300">
            <h1 className="text-2xl font-bold tracking-tight ripple-effect">{t('title')}</h1>
            <nav className="flex items-center gap-2">
              <button
                onClick={() => setRoute("feed")}
                className={`px-3 py-1 rounded-md ripple-effect ${route === "feed" ? "bg-gray-800" : "bg-transparent"}`}
              >
                {t('hotMemes')}
              </button>
              <button
                onClick={() => setRoute("anime")}
                className={`px-3 py-1 rounded-md ripple-effect ${route === "anime" ? "bg-gray-800" : "bg-transparent"}`}
              >
                {t('animeWatching')}
              </button>
              <button
                onClick={() => setRoute("credits")}
                className={`px-3 py-1 rounded-md ripple-effect ${route === "credits" ? "bg-gray-800" : "bg-transparent"}`}
              >
                {t('credits')}
              </button>
              <button
                onClick={handleAdminClick}
                className={`px-3 py-1 rounded-md ripple-effect ${route === "admin" ? "bg-gray-800" : "bg-transparent"}`}
              >
                {t('admin')}
              </button>
              <button
                onClick={loadFeeds}
                className="px-3 py-1 rounded-md bg-gray-800 ml-2 ripple-effect loading-pulse"
              >
                {t('refresh')}
              </button>
              <button
                onClick={() => setLang(lang === 'zh' ? 'en' : 'zh')}
                className="px-3 py-1 rounded-md bg-indigo-600 ml-2 text-sm ripple-effect"
              >
                {lang === 'zh' ? 'EN' : 'ZH'}
              </button>
              <button
                onClick={() => setShowBoyKisser(true)}
                className="p-1 rounded hover:bg-gray-800 transition-colors ml-2 ripple-effect"
                title={t('boyKisser')}
              >
                <img
                  src="https://tse4.mm.bing.net/th/id/OIP.piRzWtMCSbpX-WL21vFMSgAAAA?rs=1&pid=ImgDetMain&o=7&rm=3"
                  alt={t('boyKisser')}
                  className="w-8 h-8 rounded transition-transform duration-200 hover:scale-110"
                />
              </button>
            </nav>
          </header>
          <main className="p-6">
            {route === "feed" ? (
              <FeedPage
                loading={loading}
                error={error}
                filteredFeed={filteredFeed}
                activeTab={activeTab}
                setActiveTab={handleTabClick}
                timeFilter={timeFilter}
                setTimeFilter={setTimeFilter}
                selectedMeme={selectedMeme}
                setSelectedMeme={setSelectedMeme}
                loadMore={loadMoreFeed}
                hasMore={hasMore}
                isLoadingMore={isLoadingMore}
                t={t}
              />
            ) : route === "credits" ? (
              <CreditsPage onBack={() => setRoute("feed")} t={t} />
            ) : route === "admin" ? (
              <AdminPage videos={videos} videosLoading={videosLoading} selectedMeme={selectedMeme} setSelectedMeme={setSelectedMeme} t={t} onBack={() => setRoute("feed")} />
            ) : (
              <AnimePage onBack={() => setRoute("feed")} t={t} />
            )}
            {selectedMeme && (
              <ImageModal meme={selectedMeme} onClose={() => setSelectedMeme(null)} t={t} />
            )}
            {showBoyKisser && (
              <ImageModal meme={boyKisserMeme} onClose={() => setShowBoyKisser(false)} t={t} />
            )}
            {showAdminPassword && (
              <div className="password-modal modal-fade">
                <form onSubmit={handlePasswordSubmit} className="bg-gray-800 p-6 rounded shadow-lg flex flex-col items-center gap-4">
                  <h2 className="text-xl font-bold">Admin Password</h2>
                  <input
                    type="password"
                    value={passwordInput}
                    onChange={(e) => setPasswordInput(e.target.value)}
                    className="password-input"
                    placeholder="Enter password..."
                    autoFocus
                  />
                  <button type="submit" className="px-4 py-2 bg-indigo-600 rounded hover:bg-indigo-700 transition-colors">Enter</button>
                  <button type="button" onClick={() => setShowAdminPassword(false)} className="px-4 py-2 bg-gray-600 rounded hover:bg-gray-700 transition-colors">Cancel</button>
                </form>
              </div>
            )}
            <footer className="mt-8 text-sm text-gray-500">{t('footer')}</footer>
          </main>
        </div>
      );
    }
    function CreditsPage({ onBack, t }) {
      return (
        <section>
          <div className="flex items-center justify-between mb-4">
            <div className="flex items-center gap-4">
              <button onClick={onBack} className="px-3 py-1 rounded bg-gray-800 ripple-effect">{t('back')}</button>
              <div className="text-lg font-semibold">{t('credits')}</div>
            </div>
          </div>
          <div className="bg-gray-800 p-6 rounded shadow-sm transition-all duration-300 hover:shadow-lg">
            <h2 className="text-xl font-bold mb-4">Production Staff</h2>
            <ul className="space-y-2 text-sm">
              <li><strong>Author:</strong> Giu Giu</li>
              <li><strong>Helpers:</strong> GPT and Grok (just API)</li>
              <li><strong>IDK:</strong> IDK</li>
            </ul>
          </div>
        </section>
      );
    }
    function FeedPage({ loading, error, filteredFeed, activeTab, setActiveTab, timeFilter, setTimeFilter, selectedMeme, setSelectedMeme, loadMore, hasMore, isLoadingMore, t }) {
      const sentinelRef = useRef(null);
      useEffect(() => {
        const observer = new IntersectionObserver(
          ([entry]) => {
            if (entry.isIntersecting && hasMore && !isLoadingMore) {
              loadMore(activeTab);
            }
          },
          { threshold: 0.1 }
        );
        if (sentinelRef.current) {
          observer.observe(sentinelRef.current);
        }
        return () => {
          if (sentinelRef.current) {
            observer.unobserve(sentinelRef.current);
          }
        };
      }, [hasMore, isLoadingMore, activeTab, loadMore]);
      const indicatorLeft = activeTab === "foreign" ? "4px" : "calc(50% + 2px)";
      return (
        <section>
          <div className="flex items-center justify-between mb-4 flex-wrap gap-2">
            <div className="tab-container">
              <div className="tab-indicator" style={{ left: indicatorLeft }}></div>
              <TabButton
                label={t('overseas')}
                active={activeTab === "foreign"}
                onClick={() => setActiveTab("foreign")}
              />
              <TabButton
                label={`${t('domestic')} ${t('unstable')}`}
                active={activeTab === "domestic"}
                onClick={() => setActiveTab("domestic")}
              />
            </div>
            <div className="flex items-center gap-2">
              <label className="text-sm text-gray-400">{t('timeFilter')}</label>
              <select
                value={timeFilter}
                onChange={(e) => setTimeFilter(e.target.value)}
                className="px-2 py-1 rounded bg-gray-800 text-sm"
              >
                <option value="all">{t('all')}</option>
                <option value="today">{t('today')}</option>
                <option value="week">{t('week')}</option>
                <option value="month">{t('month')}</option>
              </select>
            </div>
            <div className="text-sm text-gray-400">{t('multiSource')}</div>
          </div>
          {loading && <div className="py-12 text-center loading-pulse">{t('loading')}</div>}
          {error && <div className="py-4 text-red-400 animate-pulse">{error}</div>}
          <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
            {filteredFeed.map((m, index) => (
              <MemeCard key={m.id} meme={m} onClick={() => setSelectedMeme(m)} className={`grid-item meme-card`} style={{ animationDelay: `${(index % 4) * 0.1}s` }} />
            ))}
          </div>
          {hasMore && (
            <div ref={sentinelRef} className="h-20 flex justify-center items-center">
              {isLoadingMore ? <div className="text-gray-400 loading-pulse">{t('loadingMore')}</div> : <div className="text-gray-500">{t('end')}</div>}
            </div>
          )}
          {filteredFeed.length === 0 && !loading && (
            <div className="py-12 text-center text-gray-400">{t('noResults')}</div>
          )}
        </section>
      );
    }
    function TabButton({ label, active, onClick }) {
      return (
        <button
          onClick={onClick}
          className={`tab-button ${active ? "active" : ""}`}
        >
          {label}
        </button>
      );
    }
    function AdminPage({ videos, videosLoading, selectedMeme, setSelectedMeme, t, onBack }) {
      return (
        <section className="relative z-10"> {/* Ensure content is above background */}
          <div className="flex items-center justify-between mb-4">
            <div className="flex items-center gap-4">
              <button onClick={onBack} className="px-3 py-1 rounded bg-gray-800 ripple-effect">{t('back')}</button>
              <div className="text-lg font-semibold">Admin Panel</div>
            </div>
          </div>
          {/* Videos Section */}
          <div>
            <h2 className="text-xl font-bold mb-4">{t('videosTitle')}</h2>
            {videosLoading && (
              <div className="py-12 text-center">
                <p className="text-gray-400 mb-4">{t('loadingVideos')}</p>
                <div className="progress-bar mx-auto max-w-md">
                  <div className="progress-fill"></div>
                </div>
              </div>
            )}
            <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
              {videos.map((v, index) => (
                <VideoCard key={v.id} video={v} className={`grid-item video-card`} style={{ animationDelay: `${(index % 4) * 0.1}s` }} />
              ))}
            </div>
            {videos.length === 0 && !videosLoading && <div className="py-12 text-center text-gray-400">Loading videos... (Note: Douyin may require additional proxy/API for full integration)</div>}
          </div>
        </section>
      );
    }
    function MemeCard({ meme, onClick, className }) {
      const [show, setShow] = useState(false);
      return (
        <article
          className={`bg-gray-800 p-2 rounded shadow-sm overflow-hidden cursor-pointer ripple-effect ${className || ""}`}
          onClick={onClick}
        >
          <div className="relative w-full h-48 bg-gray-700 rounded overflow-hidden transition-all duration-300">
            <img
              src={meme.url}
              alt={meme.title}
              className="w-full h-full object-cover transition-opacity duration-300"
              onLoad={() => setShow(true)}
              onError={() => setShow(true)}
              style={{ opacity: show ? 1 : 0 }}
            />
            {!show && <div className="absolute inset-0 flex items-center justify-center">Loading...</div>}
          </div>
          <div className="mt-2">
            <div className="text-sm font-semibold truncate">{meme.title}</div>
            <div className="text-xs text-gray-400 flex justify-between">
              <span>{meme.source || "source"}</span>
              {meme.date && <span className="text-gray-500">{meme.date}</span>}
            </div>
          </div>
        </article>
      );
    }
    // VideoCard component - handles YouTube embeds too
    function VideoCard({ video, className }) {
      const [show, setShow] = useState(false);
      const handleClick = () => {
        if (video.embedUrl) {
          window.open(video.embedUrl, '_blank');
        }
      };
      return (
        <article onClick={handleClick} className={`bg-gray-800 p-2 rounded shadow-sm overflow-hidden cursor-pointer ripple-effect ${className || ""}`}>
          <div className="relative w-full h-48 bg-gray-700 rounded overflow-hidden transition-all duration-300 video-player">
            <img
              src={video.thumbnail}
              alt={video.title}
              className="w-full h-full object-cover transition-opacity duration-300 absolute top-0 left-0"
              onLoad={() => setShow(true)}
              onError={() => setShow(true)}
              style={{ opacity: show ? 1 : 0 }}
            />
            {!show && <div className="absolute inset-0 flex items-center justify-center">Loading...</div>}
            {video.embedUrl && (
              <iframe
                src={video.embedUrl}
                title={video.title}
                allowFullScreen
                className="hidden" // Hidden, shown on hover or click if needed
              />
            )}
          </div>
          <div className="mt-2">
            <div className="text-sm font-semibold truncate">{video.title}</div>
            <div className="text-xs text-gray-400">{video.source}</div>
            {video.date && <div className="text-xs text-gray-500 mt-1">{video.date}</div>}
          </div>
        </article>
      );
    }
    function ImageModal({ meme, onClose, t }) {
      return (
        <div className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 modal-fade">
          <div className="relative max-w-4xl max-h-full p-4 animate-scale-in">
            <button
              onClick={onClose}
              className="absolute top-2 right-2 text-white text-4xl font-bold z-10 px-2 py-1 rounded hover:bg-gray-800 transition-colors ripple-effect"
            >
              Ã—
            </button>
            <img
              src={meme.url}
              alt={meme.title}
              className="max-w-full max-h-[90vh] object-contain rounded shadow-lg transition-transform duration-300 hover:scale-105"
            />
            <div className="mt-4 text-center text-white">
              <h3 className="text-lg font-semibold">{meme.title}</h3>
              <p className="text-sm text-gray-300">{meme.source || "source"}</p>
              {meme.date && <p className="text-sm text-gray-400">{meme.date}</p>}
            </div>
          </div>
        </div>
      );
    }
    function AnimePage({ onBack, t }) {
      const animeList = [
        {
          id: 1,
          title: "Onimai (ãŠå…„ã¡ã‚ƒã‚“ã¯ãŠã—ã¾ã„ï¼)",
          poster: "https://tse4.mm.bing.net/th/id/OIP.uFVmquY49ImPRvhtYB5SeQHaKb?rs=1&pid=ImgDetMain&o=7&rm=3",
          description: t('animeDesc'),
          episodes: t('episodes'),
          status: t('status'),
          url: "https://onimai.jp/"
        }
      ];
      return (
        <section>
          <div className="flex items-center justify-between mb-4">
            <div className="flex items-center gap-4">
              <button onClick={onBack} className="px-3 py-1 rounded bg-gray-800 ripple-effect">{t('back')}</button>
              <div className="text-lg font-semibold">{t('animeTitle')}</div>
            </div>
          </div>
          <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
            {animeList.map((anime, index) => (
              <AnimeCard key={anime.id} anime={anime} className={`grid-item anime-card`} style={{ animationDelay: `${index * 0.1}s` }} />
            ))}
          </div>
          <div className="mt-4 text-sm text-gray-500">{t('animeListNote')}</div>
        </section>
      );
    }
    function AnimeCard({ anime, className }) {
      const [show, setShow] = useState(false);
      const handleClick = () => {
        window.location.href = anime.url;
      };
      return (
        <article onClick={handleClick} className={`bg-gray-800 p-2 rounded shadow-sm overflow-hidden cursor-pointer ripple-effect ${className || ""}`}>
          <div className="relative w-full h-48 bg-gray-700 rounded overflow-hidden transition-all duration-300">
            <img
              src={anime.poster}
              alt={anime.title}
              className="w-full h-full object-cover transition-opacity duration-300"
              onLoad={() => setShow(true)}
              onError={() => setShow(true)}
              style={{ opacity: show ? 1 : 0 }}
            />
            {!show && <div className="absolute inset-0 flex items-center justify-center">Loading...</div>}
          </div>
          <div className="mt-2">
            <div className="text-sm font-semibold truncate">{anime.title}</div>
            <div className="text-xs text-gray-400">{anime.status}</div>
            <div className="text-xs text-gray-500 mt-1 line-clamp-2">{anime.description}</div>
            <div className="text-xs text-indigo-400 mt-1">{anime.episodes}</div>
          </div>
        </article>
      );
    }
    // -------------------------- Fetching and source logic --------------------------
    // Helpers: timeout fetch
    async function fetchWithTimeout(url, opts = {}, timeout = 8000) {
      const controller = new AbortController();
      const id = setTimeout(() => controller.abort(), timeout);
      try {
        const res = await fetch(url, { ...opts, signal: controller.signal });
        clearTimeout(id);
        return res;
      } finally {
        clearTimeout(id);
      }
    }
    async function tryFetchSources(sources) {
      let allImgs = [];
      for (const s of sources) {
        try {
          let data;
          if (s.url) {
            const res = await fetchWithTimeout(s.url, { method: s.method || "GET", headers: s.headers || {} }, s.timeout || 9000);
            if (!res.ok) throw new Error(`${s.name} status ${res.status}`);
            data = await res[s.resType || "json"]();
          } // else: æ—  urlï¼Œç›´æ¥è·³è¿‡ fetch
          // æ ¹æ®æ˜¯å¦æœ‰ url è°ƒç”¨ parserï¼ˆæœ‰ data ä¼  dataï¼Œæ— åˆ™ä¼  undefinedï¼‰
          const imgs = s.url ? await s.parser(data) : await s.parser();
          if (Array.isArray(imgs) && imgs.length > 0) {
            allImgs = allImgs.concat(imgs);
            console.info(`source ${s.name} added ${imgs.length}`);
          }
        } catch (e) {
          console.warn(`source ${s.name} failed:`, e);
        }
      }
      return allImgs;
    }
    // Fetch videos from Bilibili, Douyin, and YouTube
    async function tryFetchVideos() {
      const sources = [
        {
          name: "YouTube_Popular",
          // æ—  urlï¼Œç›´æ¥ç”¨ parser è¿”å› sample è§†é¢‘ï¼ˆ20 ä¸ªçƒ­é—¨ï¼Œthumbnails å’Œ embed éƒ½èƒ½ç›´æ¥ç”¨ï¼‰
          parser: async () => {
            const sampleVideos = [
              {
                id: "dQw4w9WgXcQ",
                title: "Rick Astley - Never Gonna Give You Up",
                thumbnail: "https://i.ytimg.com/vi/dQw4w9WgXcQ/maxresdefault.jpg",
                source: "YouTube Popular",
                date: new Date().toDateString(),
                embedUrl: "https://www.youtube.com/embed/dQw4w9WgXcQ"
              },
              {
                id: "kJQP7kiw5Fk",
                title: "PSY - GANGNAM STYLE",
                thumbnail: "https://i.ytimg.com/vi/kJQP7kiw5Fk/maxresdefault.jpg",
                source: "YouTube Popular",
                date: new Date().toDateString(),
                embedUrl: "https://www.youtube.com/embed/kJQP7kiw5Fk"
              },
              {
                id: "9bZkp7q19f0",
                title: "Despacito - Luis Fonsi ft. Daddy Yankee",
                thumbnail: "https://i.ytimg.com/vi/9bZkp7q19f0/maxresdefault.jpg",
                source: "YouTube Popular",
                date: new Date().toDateString(),
                embedUrl: "https://www.youtube.com/embed/9bZkp7q19f0"
              },
              {
                id: "8S5wyQfH0CY",
                title: "Johny Johny Yes Papa",
                thumbnail: "https://i.ytimg.com/vi/8S5wyQfH0CY/maxresdefault.jpg",
                source: "YouTube Popular",
                date: new Date().toDateString(),
                embedUrl: "https://www.youtube.com/embed/8S5wyQfH0CY"
              },
              {
                id: "C0DPdy98e4c",
                title: "Baby Shark Dance",
                thumbnail: "https://i.ytimg.com/vi/C0DPdy98e4c/maxresdefault.jpg",
                source: "YouTube Popular",
                date: new Date().toDateString(),
                embedUrl: "https://www.youtube.com/embed/C0DPdy98e4c"
              },
              {
                id: "jNQXAC9IVRw",
                title: "PPAP (Pen Pineapple Apple Pen)",
                thumbnail: "https://i.ytimg.com/vi/jNQXAC9IVRw/maxresdefault.jpg",
                source: "YouTube Popular",
                date: new Date().toDateString(),
                embedUrl: "https://www.youtube.com/embed/jNQXAC9IVRw"
              },
              {
                id: "ZX3ncRvVgtg",
                title: "Ed Sheeran - Shape of You",
                thumbnail: "https://i.ytimg.com/vi/ZX3ncRvVgtg/maxresdefault.jpg",
                source: "YouTube Popular",
                date: new Date().toDateString(),
                embedUrl: "https://www.youtube.com/embed/ZX3ncRvVgtg"
              },
              {
                id: "DLzxrzFCyOs",
                title: "Wiz Khalifa - See You Again ft. Charlie Puth",
                thumbnail: "https://i.ytimg.com/vi/DLzxrzFCyOs/maxresdefault.jpg",
                source: "YouTube Popular",
                date: new Date().toDateString(),
                embedUrl: "https://www.youtube.com/embed/DLzxrzFCyOs"
              },
              {
                id: "7YIb3w2fM2A",
                title: "Katy Perry - Roar",
                thumbnail: "https://i.ytimg.com/vi/7YIb3w2fM2A/maxresdefault.jpg",
                source: "YouTube Popular",
                date: new Date().toDateString(),
                embedUrl: "https://www.youtube.com/embed/7YIb3w2fM2A"
              },
              {
                id: "pRpeEdMmmQ0",
                title: "Taylor Swift - Shake It Off",
                thumbnail: "https://i.ytimg.com/vi/pRpeEdMmmQ0/maxresdefault.jpg",
                source: "YouTube Popular",
                date: new Date().toDateString(),
                embedUrl: "https://www.youtube.com/embed/pRpeEdMmmQ0"
              },
              {
                id: "tAGnKpE4NCI",
                title: "Mark Ronson - Uptown Funk ft. Bruno Mars",
                thumbnail: "https://i.ytimg.com/vi/tAGnKpE4NCI/maxresdefault.jpg",
                source: "YouTube Popular",
                date: new Date().toDateString(),
                embedUrl: "https://www.youtube.com/embed/tAGnKpE4NCI"
              },
              {
                id: "LRP8OYEfb0U",
                title: "The Chainsmokers - Closer ft. Halsey",
                thumbnail: "https://i.ytimg.com/vi/LRP8OYEfb0U/maxresdefault.jpg",
                source: "YouTube Popular",
                date: new Date().toDateString(),
                embedUrl: "https://www.youtube.com/embed/LRP8OYEfb0U"
              },
              {
                id: "K4DyBug242c",
                title: "Luis Fonsi - Ã‰chame La Culpa (Official Video) ft. Demi Lovato",
                thumbnail: "https://i.ytimg.com/vi/K4DyBug242c/maxresdefault.jpg",
                source: "YouTube Popular",
                date: new Date().toDateString(),
                embedUrl: "https://www.youtube.com/embed/K4DyBug242c"
              },
              {
                id: "5ISu9jzK1rA",
                title: "Clean Bandit - Rockabye ft. Sean Paul & Anne-Marie",
                thumbnail: "https://i.ytimg.com/vi/5ISu9jzK1rA/maxresdefault.jpg",
                source: "YouTube Popular",
                date: new Date().toDateString(),
                embedUrl: "https://www.youtube.com/embed/5ISu9jzK1rA"
              },
              {
                id: "E8W7L5jCo40",
                title: "The Chainsmokers - Don't Let Me Down ft. Daya",
                thumbnail: "https://i.ytimg.com/vi/E8W7L5jCo40/maxresdefault.jpg",
                source: "YouTube Popular",
                date: new Date().toDateString(),
                embedUrl: "https://www.youtube.com/embed/E8W7L5jCo40"
              },
              {
                id: "cFFZJGm4l_U",
                title: "DNCE - Cake By The Ocean",
                thumbnail: "https://i.ytimg.com/vi/cFFZJGm4l_U/maxresdefault.jpg",
                source: "YouTube Popular",
                date: new Date().toDateString(),
                embedUrl: "https://www.youtube.com/embed/cFFZJGm4l_U"
              },
              {
                id: "yQFe1VqB20M",
                title: "Twenty One Pilots - Stressed Out",
                thumbnail: "https://i.ytimg.com/vi/yQFe1VqB20M/maxresdefault.jpg",
                source: "YouTube Popular",
                date: new Date().toDateString(),
                embedUrl: "https://www.youtube.com/embed/yQFe1VqB20M"
              },
              {
                id: "LFBuV4CLG3c",
                title: "The Weeknd - Starboy ft. Daft Punk",
                thumbnail: "https://i.ytimg.com/vi/LFBuV4CLG3c/maxresdefault.jpg",
                source: "YouTube Popular",
                date: new Date().toDateString(),
                embedUrl: "https://www.youtube.com/embed/LFBuV4CLG3c"
              },
              {
                id: "A5o-sw4gReg",
                title: "M Pitbull - Timber ft. Ke$ha",
                thumbnail: "https://i.ytimg.com/vi/A5o-sw4gReg/maxresdefault.jpg",
                source: "YouTube Popular",
                date: new Date().toDateString(),
                embedUrl: "https://www.youtube.com/embed/A5o-sw4gReg"
              }
            ];
            console.log("Loaded 20 sample YouTube videos.");
            return sampleVideos;
          },
        },
      ];
      return await tryFetchSources(sources);
    }
    async function tryFetchForeignImages() {
      const sources = [
        {
          name: "MemeAPI_gimme",
          url: "https://meme-api.com/gimme/50",
          parser: async (d) => {
            const arr = Array.isArray(d.memes || d) ? (d.memes || d) : (d ? [d] : []);
            const out = (arr || []).map((p, i) => ({
              id: p.postLink || `memeapi-${i}`,
              title: p.title || "meme",
              url: p.url,
              source: p.subreddit || "meme-api",
              date: null
            })).filter(x => x.url);
            return out;
          },
        },
        {
          name: "Imgflip_templates",
          url: "https://api.imgflip.com/get_memes",
          parser: async (d) => {
            const memes = d?.data?.memes || [];
            return memes.map((m) => ({
              id: m.id,
              title: m.name,
              url: m.url,
              source: "imgflip",
              date: null
            }));
          },
        },
        {
          name: "Reddit_r_memes",
          url: "https://www.reddit.com/r/memes/top.json?limit=50&t=day",
          parser: async (d) => {
            const children = d?.data?.children || [];
            const out = [];
            for (const c of children) {
              const post = c.data;
              if (post.over_18) continue; // Skip NSFW
              const url = post.preview?.images?.[0]?.source?.url?.replace(/&amp;/g, "&") || post.url;
              if (url && (url.endsWith('.jpg') || url.endsWith('.png') || url.includes('i.redd.it') || url.includes('i.imgur.com') || url.startsWith('http'))) {
                const date = post.created_utc ? new Date(post.created_utc * 1000).toDateString() : null;
                out.push({ id: post.id, title: post.title, url, source: `r/${post.subreddit}`, date });
              }
            }
            return out;
          },
        },
        {
          name: "Reddit_dank",
          url: "https://www.reddit.com/r/dankmemes/top.json?limit=50&t=day",
          parser: async (d) => {
            const children = d?.data?.children || [];
            const out = [];
            for (const c of children) {
              const post = c.data;
              if (post.over_18) continue; // Skip NSFW
              const url = post.preview?.images?.[0]?.source?.url?.replace(/&amp;/g, "&") || post.url;
              if (url) {
                const date = post.created_utc ? new Date(post.created_utc * 1000).toDateString() : null;
                out.push({ id: post.id, title: post.title, url, source: `r/${post.subreddit}`, date });
              }
            }
            return out;
          },
        },
      ];
      return await tryFetchSources(sources);
    }
    async function tryFetchDomesticImages() {
      const CORS_PROXY = 'https://api.allorigins.win/raw?url=';
      const targetUrl = 'https://memes.tw/';
      const sources = [
        {
          name: "memes.tw",
          url: CORS_PROXY + encodeURIComponent(targetUrl),
          resType: "text",
          timeout: 10000,
          parser: async (html) => {
            console.log("Parsing memes.tw HTML...");
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, "text/html");
            const memeElements = doc.querySelectorAll('img[src*="jpg"], img[src*="png"], img[data-src*="jpg"], img[data-src*="png"], .entry-content img, .post-content img, .meme-container img, article img, .wp-post-image');
            const out = [];
            let i = 0;
            for (const img of memeElements) {
              if (i >= 50) break;
              let src = img.src || img.getAttribute('data-src') || img.getAttribute('data-lazy-src') || img.getAttribute('srcset')?.split(',')[0]?.trim().split(' ')[0];
              if (!src) continue;
              if (src.includes('srcset')) src = src.split(',')[0].trim().split(' ')[0];
              if (src && (src.includes('.jpg') || src.includes('.png') || src.includes('.gif')) && !src.includes('avatar') && !src.includes('logo') && !src.includes('icon') && !src.includes('wp-includes')) {
                let parent = img.closest('article, .post, .entry, .meme, .item, .card, div[class*="post"], div[class*="entry"], section') || img.parentElement;
                if (!parent) parent = img;
                let titleEl = parent.querySelector('h1, h2, h3, h4, .title, .headline, .post-title, .entry-title, p, .caption') || img;
                let title = (titleEl.textContent || titleEl.alt || titleEl.title || `å°æ¹¾çƒ­æ¢— ${i + 1}`).trim().substring(0, 50);
                if (!title || title.length < 3) title = `å°æ¹¾çƒ­æ¢— ${i + 1}`;
                let dateEl = parent.querySelector('.date, .time, time, .published, [datetime], .post-date') || parent.querySelector('time');
                let date = dateEl ? (dateEl.textContent || dateEl.getAttribute('datetime')).trim() : null;
                if (date && !date.includes('Date')) date = new Date(date).toDateString() || date;
                let fullUrl;
                try {
                  fullUrl = src.startsWith('http') ? src : new URL(src, targetUrl).href;
                } catch (e) {
                  console.warn("Invalid URL:", src);
                  continue;
                }
                out.push({
                  id: `memes-${i}-${Date.now()}`,
                  title,
                  url: fullUrl,
                  source: "memes.tw",
                  date
                });
                i++;
              }
            }
            console.log(`Parsed ${out.length} memes from memes.tw. Sample:`, out.slice(0, 2));
            if (out.length === 0) {
              console.warn("No images from memes.tw - site likely JS-heavy, consider browser extension or proxy for full render.");
            }
            return out.filter(x => x.url && x.url.length > 10 && !x.url.includes('data:image'));
          },
        },
        {
          name: "Bilibili_dynamic",
          url: "https://api.bilibili.com/x/polymer/web-dynamic/v1/feed/all?type=1688&pn=1",
          headers: {
            "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36"
          },
          parser: async (d) => {
            const items = d?.data?.items || [];
            const out = [];
            for (const item of items) {
              const modules = item?.modules?.module_dynamic || {};
              const major = modules?.major || {};
              let pic = null;
              let title = null;
              const draw = major?.draw || {};
              if (draw?.items && draw.items.length > 0) {
                pic = draw.items[0]?.src;
                title = draw.desc || null;
              }
              if (!pic) {
                const archive = major?.archive || {};
                pic = archive?.cover;
                title = archive?.title?.text || null;
              }
              if (pic && (pic.includes('.jpg') || pic.includes('.png'))) {
                const id = item.id_str || `bili-${Math.random().toString(36).substr(2, 9)}`;
                if (!title) {
                  const user = item?.user || {};
                  title = user.name ? `${user.name}çš„å›¾ç‰‡` : "Bili åŠ¨æ€";
                }
                title = title.substring(0, 50);
                const date = major?.time ? new Date(major.time * 1000).toDateString() : null;
                out.push({
                  id,
                  title,
                  url: pic,
                  source: "bilibili",
                  date
                });
              }
            }
            console.log(`Parsed ${out.length} memes from Bilibili. Sample:`, out.slice(0, 2));
            return out;
          },
        },
      ];
      return await tryFetchSources(sources);
    }
    // Utilities
    function shuffleArray(a) {
      const arr = [...a];
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }
    // Render the app
    ReactDOM.render(<MemeWaveApp />, document.getElementById('root'));
  </script>
</body>
</html>
